<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™ì› í•™ë¶€ëª¨ ì‘ëŒ€ë´‡ ë°ëª¨</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ«</text></svg>">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif; background: #f0faf4; min-height: 100vh; }
        .container { max-width: 760px; margin: 0 auto; padding: 24px 16px; }

        .header { background: linear-gradient(135deg, #059669, #10b981); color: white; padding: 24px; border-radius: 16px; margin-bottom: 20px; }
        .header h1 { font-size: 1.4rem; font-weight: 700; margin-bottom: 6px; }
        .header p { font-size: 0.88rem; opacity: 0.88; line-height: 1.5; }
        .badge { display: inline-block; background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; font-size: 0.78rem; margin-top: 10px; }

        .card { background: white; border-radius: 16px; padding: 20px; margin-bottom: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.06); }
        .card h2 { font-size: 0.95rem; color: #374151; margin-bottom: 14px; font-weight: 600; }

        .btn { border: none; padding: 10px 18px; border-radius: 8px; cursor: pointer; font-size: 0.88rem; font-weight: 500; transition: opacity 0.15s; }
        .btn:hover { opacity: 0.85; }
        .btn-outline { background: #f9fafb; border: 1px solid #d1d5db; color: #374151; }
        .btn-green { background: #10b981; color: white; margin-left: 8px; }
        .upload-status { margin-top: 10px; font-size: 0.83rem; color: #6b7280; min-height: 20px; }

        .messages { min-height: 320px; max-height: 420px; overflow-y: auto; margin-bottom: 14px; display: flex; flex-direction: column; gap: 14px; }
        .message { display: flex; flex-direction: column; }
        .message.user { align-items: flex-end; }
        .message.bot { align-items: flex-start; }
        .label { font-size: 0.75rem; color: #9ca3af; margin-bottom: 4px; }
        .bubble { padding: 12px 16px; border-radius: 14px; max-width: 78%; font-size: 0.9rem; line-height: 1.65; word-break: keep-all; }
        .user .bubble { background: #10b981; color: white; border-bottom-right-radius: 4px; }
        .bot .bubble { background: #f0fdf4; color: #111827; border: 1px solid #d1fae5; border-bottom-left-radius: 4px; }
        .bubble.loading { color: #9ca3af; font-style: italic; }

        .input-row { display: flex; gap: 8px; }
        .input-row input { flex: 1; border: 1.5px solid #e5e7eb; border-radius: 10px; padding: 12px 14px; font-size: 0.9rem; outline: none; transition: border-color 0.15s; font-family: inherit; }
        .input-row input:focus { border-color: #10b981; }
        .input-row button { background: #10b981; color: white; border: none; border-radius: 10px; padding: 12px 20px; cursor: pointer; font-size: 0.9rem; font-weight: 500; white-space: nowrap; }
        .input-row button:hover { background: #059669; }

        .questions { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 14px; }
        .q-chip { background: #ecfdf5; color: #059669; border: 1px solid #a7f3d0; padding: 6px 12px; border-radius: 20px; font-size: 0.82rem; cursor: pointer; transition: background 0.15s; }
        .q-chip:hover { background: #d1fae5; }

        .divider { border: none; border-top: 1px solid #f0fdf4; margin: 12px 0; }
        .footer { text-align: center; font-size: 0.78rem; color: #9ca3af; margin-top: 12px; }

        .roi-box { background: #ecfdf5; border: 1px solid #a7f3d0; border-radius: 12px; padding: 14px 18px; margin-bottom: 16px; }
        .roi-box p { font-size: 0.85rem; color: #065f46; line-height: 1.7; }
        .roi-box strong { color: #059669; }
    </style>
</head>
<body>
<div class="container">

    <div class="header">
        <h1>ğŸ« í•™ì› í•™ë¶€ëª¨ ì‘ëŒ€ë´‡</h1>
        <p>í•™ë¶€ëª¨ ë°˜ë³µ ë¬¸ì˜ë¥¼ AIê°€ 24ì‹œê°„ ìë™ìœ¼ë¡œ ì‘ëŒ€í•©ë‹ˆë‹¤<br>ì›ì¥ë‹˜ì€ ì¤‘ìš”í•œ ìƒë‹´ì—ë§Œ ì§‘ì¤‘í•˜ì„¸ìš”</p>
        <span class="badge" id="statusBadge">â— ëŒ€ê¸° ì¤‘</span>
    </div>

    <div class="roi-box">
        <p>ğŸ“Š ë„ì… íš¨ê³¼: í•™ë¶€ëª¨ ë¬¸ì˜ ì‘ëŒ€ <strong>ì›” 30ì‹œê°„ ì ˆì•½</strong> Â· ì•¼ê°„Â·ì£¼ë§ ìë™ ì‘ëŒ€ Â· ì¦‰ê° ì‘ë‹µìœ¼ë¡œ <strong>í•™ë¶€ëª¨ ë§Œì¡±ë„ í–¥ìƒ</strong></p>
    </div>

    <div class="card">
        <h2>ğŸ“„ í•™ì› ì•ˆë‚´ ìë£Œ ë“±ë¡</h2>
        <input type="file" id="pdfInput" accept=".pdf" style="display:none">
        <button class="btn btn-outline" onclick="document.getElementById('pdfInput').click()">ğŸ“‚ PDF ì—…ë¡œë“œ</button>
        <button class="btn btn-green" onclick="loadSampleData()">âœ¨ ìƒ˜í”Œë¡œ ë°”ë¡œ ì²´í—˜</button>
        <p class="upload-status" id="uploadStatus">í•™ì› ì•ˆë‚´ë¬¸ PDFë¥¼ ì˜¬ë¦¬ê±°ë‚˜, ìƒ˜í”Œ ë°ì´í„°ë¡œ ë¨¼ì € ì²´í—˜í•´ë³´ì„¸ìš”.</p>
    </div>

    <div class="card">
        <h2>ğŸ’¬ í•™ë¶€ëª¨ ë¬¸ì˜ ì‘ëŒ€</h2>

        <p style="font-size:0.82rem; color:#6b7280; margin-bottom:10px;">ìì£¼ ì˜¤ëŠ” ë¬¸ì˜ ì˜ˆì‹œ</p>
        <div class="questions">
            <span class="q-chip" onclick="fillQuestion('ì›ë¹„ëŠ” ì–¸ì œê¹Œì§€ ë‚´ì•¼ í•˜ë‚˜ìš”?')">ì›ë¹„ ë‚©ë¶€ì¼</span>
            <span class="q-chip" onclick="fillQuestion('ìˆ˜ì—…ì€ ëª‡ ì‹œì— ì‹œì‘í•˜ë‚˜ìš”?')">ìˆ˜ì—… ì‹œê°„</span>
            <span class="q-chip" onclick="fillQuestion('ì•„ì´ê°€ ê²°ì„í•˜ë©´ ì–´ë–»ê²Œ ì—°ë½í•˜ë‚˜ìš”?')">ê²°ì„ ì—°ë½</span>
            <span class="q-chip" onclick="fillQuestion('ë³´ê°• ìˆ˜ì—…ì€ ì–´ë–»ê²Œ ì‹ ì²­í•˜ë‚˜ìš”?')">ë³´ê°• ì‹ ì²­</span>
            <span class="q-chip" onclick="fillQuestion('í™˜ë¶ˆì€ ì–´ë–»ê²Œ ë°›ë‚˜ìš”?')">í™˜ë¶ˆ ì •ì±…</span>
            <span class="q-chip" onclick="fillQuestion('ì¤€ë¹„ë¬¼ì´ ë­ê°€ ìˆë‚˜ìš”?')">ì¤€ë¹„ë¬¼</span>
        </div>

        <hr class="divider">

        <div class="messages" id="messages">
            <div class="message bot">
                <span class="label">ğŸ« í•™ì› ì•ˆë‚´ë´‡</span>
                <div class="bubble">ì•ˆë…•í•˜ì„¸ìš”! í•™ì› ê´€ë ¨ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ í¸í•˜ê²Œ ë¬¸ì˜í•´ ì£¼ì„¸ìš” ğŸ˜Š<br>ìœ„ì—ì„œ ìƒ˜í”Œ ë°ì´í„°ë¥¼ ë¨¼ì € ë¶ˆëŸ¬ì˜¤ì‹œë©´ ë°”ë¡œ ì²´í—˜í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
            </div>
        </div>

        <div class="input-row">
            <input type="text" id="questionInput" placeholder="ë¬¸ì˜ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..." onkeypress="handleEnter(event)">
            <button onclick="sendMessage()">ë¬¸ì˜</button>
        </div>
    </div>

    <div class="footer">
        Powered by ChromaDB + OpenAI gpt-4o-mini &nbsp;|&nbsp;
        <a href="https://github.com/dusttin/academy-parent-chatbot-demo" style="color:#6b7280;">GitHub</a>
        &nbsp;|&nbsp; ë„ì… ë¬¸ì˜: dusttin@naver.com
    </div>

</div>

<script>
const SAMPLE_FAQ = `
[í•™ì› ê¸°ë³¸ ì •ë³´]
í•™ì›ëª…: í•œë¹› ì˜ì–´ìˆ˜í•™ í•™ì›
ìœ„ì¹˜: ëŒ€êµ¬ ìˆ˜ì„±êµ¬ ë²”ì–´ë™ 123-4 (ë²”ì–´ë„¤ê±°ë¦¬ ë„ë³´ 3ë¶„)
ì£¼ì°¨: ê±´ë¬¼ ì§€í•˜ ì£¼ì°¨ì¥ ì´ìš© ê°€ëŠ¥ (30ë¶„ ë¬´ë£Œ)
ìš´ì˜ì‹œê°„: í‰ì¼ 14:00~22:00 / í† ìš”ì¼ 10:00~18:00 / ì¼ìš”ì¼Â·ê³µíœ´ì¼ íœ´ì›
ì—°ë½ì²˜: 053-123-4567 / ì¹´ì¹´ì˜¤í†¡ ì±„ë„ @í•œë¹›í•™ì›

[ì›ë¹„ ë° ê²°ì œ]
ì›ë¹„: ì´ˆë“± ì›” 18ë§Œì› / ì¤‘ë“± ì›” 22ë§Œì› / ê³ ë“± ì›” 28ë§Œì›
ë‚©ë¶€ì¼: ë§¤ì›” 25ì¼ (ë‹¤ìŒ ë‹¬ ìˆ˜ê°•ë£Œ)
ë‚©ë¶€ ë°©ë²•: ê³„ì¢Œì´ì²´ (êµ­ë¯¼ì€í–‰ 123456-78-901234 í•œë¹›í•™ì›) ë˜ëŠ” ì¹´ë“œ ë‹¨ë§ê¸°
í™˜ë¶ˆ ì •ì±…: ìˆ˜ì—… ì‹œì‘ ì „ ì „ì•¡ í™˜ë¶ˆ / ìˆ˜ê°• í›„ ì”ì—¬ ì¼ìˆ˜ ê¸°ì¤€ ë¹„ë¡€ í™˜ë¶ˆ
ë¯¸ë‚© ì‹œ: 3ì¼ ì´ìƒ ë¯¸ë‚© ì‹œ ë¬¸ì ì•ˆë‚´ / 15ì¼ ì´ìƒ ë¯¸ë‚© ì‹œ ìˆ˜ê°• ì •ì§€

[ìˆ˜ì—… ì¼ì •]
ì´ˆë“±ë°˜: ì›”Â·ìˆ˜Â·ê¸ˆ 15:00~17:00
ì¤‘ë“±ë°˜: ì›”Â·ìˆ˜Â·ê¸ˆ 17:00~19:30
ê³ ë“±ë°˜: ì›”~ê¸ˆ 19:30~22:00, í†  10:00~13:00
íœ´ê°•ì¼: ë²•ì •ê³µíœ´ì¼, ì„¤Â·ì¶”ì„ ì—°íœ´
ë³´ê°•: íœ´ê°• ì‹œ ë³„ë„ ë³´ê°• ìˆ˜ì—… ì§„í–‰ (ë¬¸ì ê³µì§€)

[ì¶œê²° ë° ê²°ì„]
ê²°ì„ ì—°ë½: ë‹¹ì¼ ì˜¤ì „ 10ì‹œ ì´ì „ ì¹´ì¹´ì˜¤í†¡ ì±„ë„ ë˜ëŠ” ì „í™” ì—°ë½
ì¡°í‡´: ìˆ˜ì—… ì¤‘ ì¡°í‡´ ì‹œ ë³´í˜¸ì ì§ì ‘ ë°©ë¬¸ ë˜ëŠ” ì‚¬ì „ ì—°ë½ í•„ìˆ˜
ë¬´ë‹¨ê²°ì„: 3íšŒ ì´ìƒ ë¬´ë‹¨ê²°ì„ ì‹œ í•™ë¶€ëª¨ ìƒë‹´ ì§„í–‰
ì¶œì„ë¶€: ë§¤ ìˆ˜ì—… ì¶œì„ ì²´í¬ í›„ ì›”ë§ ì¶œì„í‘œ ì¹´ì¹´ì˜¤í†¡ ë°œì†¡

[ìˆ˜ì—… ë° êµì¬]
êµì¬: í•™ì› ìì²´ í”„ë¦°íŠ¸ë¬¼ ì œê³µ (ë³„ë„ êµ¬ë§¤ ë¶ˆí•„ìš”)
ì¤€ë¹„ë¬¼: í•„ê¸°ë„êµ¬, í˜•ê´‘íœ, ê°œì¸ ë…¸íŠ¸
ìˆ™ì œ: ë§¤ ìˆ˜ì—… í›„ ìˆ™ì œ ë¶€ì—¬ / ë¯¸ì œì¶œ ì‹œ ë°©ê³¼ í›„ ì§€ë„
ë ˆë²¨ í…ŒìŠ¤íŠ¸: ì…ì› ì‹œ ë¬´ë£Œ ì§„ë‹¨ í‰ê°€ í›„ ë°˜ ë°°ì •

[ìƒë‹´ ë° ì„±ì ]
ì›”ê°„ ì„±ì  ë¦¬í¬íŠ¸: ë§¤ì›” ë§ ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ë°œì†¡
ê°œì¸ ìƒë‹´: ì›” 1íšŒ ì •ê¸° ìƒë‹´ ë˜ëŠ” ìš”ì²­ ì‹œ ìˆ˜ì‹œ ìƒë‹´
ë‹´ë‹¹ ì„ ìƒë‹˜: ì´ˆë“± ê¹€ì„ ìƒë‹˜ / ì¤‘ë“± ì´ì„ ìƒë‹˜ / ê³ ë“± ë°•ì„ ìƒë‹˜

[ê¸°íƒ€]
ê°„ì‹: ìˆ˜ì—… ì¤‘ ìŒì‹ë¬¼ ë°˜ì… ê¸ˆì§€
ë¶„ì‹¤ë¬¼: ë¶„ì‹¤ë¬¼ì€ 1ê°œì›” ë³´ê´€ í›„ íê¸°
ì‚¬ì§„Â·ì˜ìƒ: ì›ë‚´ ì´¬ì˜ì€ ì›ì¥ í—ˆê°€ í›„ ê°€ëŠ¥
`;

document.getElementById('pdfInput').addEventListener('change', uploadPDF);

async function uploadPDF(e) {
    const file = e.target.files[0];
    if (!file) return;
    const formData = new FormData();
    formData.append('file', file);
    setStatus('ì—…ë¡œë“œ ì¤‘...');
    try {
        const res = await fetch('/upload', { method: 'POST', body: formData });
        const data = await res.json();
        if (!res.ok) {
            setStatus('âŒ ' + (data.detail || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'));
            return;
        }
        setStatus(data.message);
        document.getElementById('statusBadge').textContent = `â— ${data.total_indexed}ê°œ ì²­í¬ ì¸ë±ì‹± ì™„ë£Œ`;
    } catch {
        setStatus('âŒ ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    }
}

async function loadSampleData() {
    setStatus('ìƒ˜í”Œ ë°ì´í„° ë¡œë”© ì¤‘...');
    try {
        const res = await fetch('/preload', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ content: SAMPLE_FAQ })
        });
        const data = await res.json();
        if (!res.ok) {
            setStatus('âŒ ' + (data.detail || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'));
            addMessage('bot', data.detail || 'ìƒ˜í”Œ ë°ì´í„° ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            return;
        }
        setStatus('âœ… ìƒ˜í”Œ í•™ì› ìë£Œ ë¡œë“œ ì™„ë£Œ! ì´ì œ ë¬¸ì˜í•´ë³´ì„¸ìš”.');
        document.getElementById('statusBadge').textContent = 'â— ìƒ˜í”Œ ë°ì´í„° ì¤€ë¹„ ì™„ë£Œ';
        addMessage('bot', 'í•œë¹› ì˜ì–´ìˆ˜í•™ í•™ì› ìƒ˜í”Œ ìë£Œê°€ ì¤€ë¹„ëìŠµë‹ˆë‹¤! ìœ„ ì˜ˆì‹œ ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ê±°ë‚˜ ì§ì ‘ ë¬¸ì˜í•´ë³´ì„¸ìš” ğŸ˜Š');
    } catch {
        setStatus('âŒ ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    }
}

async function sendMessage() {
    const input = document.getElementById('questionInput');
    const question = input.value.trim();
    if (!question) return;
    addMessage('user', question);
    input.value = '';
    const loadingId = addLoading();
    try {
        const res = await fetch('/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ question })
        });
        const data = await res.json();
        removeLoading(loadingId);
        addMessage('bot', data.answer || data.detail || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    } catch {
        removeLoading(loadingId);
        addMessage('bot', 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    }
}

function addMessage(role, text) {
    const messages = document.getElementById('messages');
    const div = document.createElement('div');
    div.className = `message ${role}`;

    if (role === 'bot') {
        const label = document.createElement('span');
        label.className = 'label';
        label.textContent = 'ğŸ« í•™ì› ì•ˆë‚´ë´‡';
        div.appendChild(label);
    }

    const bubble = document.createElement('div');
    bubble.className = 'bubble';
    text.split('\n').forEach((line, i) => {
        if (i > 0) bubble.appendChild(document.createElement('br'));
        bubble.appendChild(document.createTextNode(line));
    });

    div.appendChild(bubble);
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
}

function addLoading() {
    const id = 'loading_' + Date.now();
    const messages = document.getElementById('messages');
    const div = document.createElement('div');
    div.className = 'message bot';
    div.id = id;
    const label = document.createElement('span');
    label.className = 'label';
    label.textContent = 'ğŸ« í•™ì› ì•ˆë‚´ë´‡';
    const bubble = document.createElement('div');
    bubble.className = 'bubble loading';
    bubble.textContent = 'ë‹µë³€ ìƒì„± ì¤‘...';
    div.appendChild(label);
    div.appendChild(bubble);
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
    return id;
}

function removeLoading(id) {
    const el = document.getElementById(id);
    if (el) el.remove();
}

function fillQuestion(q) {
    document.getElementById('questionInput').value = q;
    document.getElementById('questionInput').focus();
}

function handleEnter(e) {
    if (e.key === 'Enter') sendMessage();
}

function setStatus(msg) {
    document.getElementById('uploadStatus').textContent = msg;
}
</script>
</body>
</html>
